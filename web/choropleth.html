<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>

    <style>
        .legend {
            background-color: #fff;
            border-radius: 3px;
            bottom: 30px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.10);
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            padding: 10px;
            position: absolute;
            right: 10px;
            z-index: 1;
        }

        .legend h4 {
            margin: 0 0 10px;
        }

        .legend div span {
            border-radius: 50%;
            display: inline-block;
            height: 10px;
            margin-right: 5px;
            width: 10px;
        }
    </style>

    <div id='map'></div>

    <div id='state-legend' class='legend'>
        <h4>Legende avant zoom</h4>
        <div><span style='background-color: #723122'></span>25,000,000</div>
        <div><span style='background-color: #8B4225'></span>10,000,000</div>
        <div><span style='background-color: #A25626'></span>7,500,000</div>
        <div><span style='background-color: #B86B25'></span>5,000,000</div>
        <div><span style='background-color: #CA8323'></span>2,500,000</div>
        <div><span style='background-color: #DA9C20'></span>1,000,000</div>
        <div><span style='background-color: #E6B71E'></span>750,000</div>
        <div><span style='background-color: #EED322'></span>500,000</div>
        <div><span style='background-color: #F2F12D'></span>0</div>
    </div>

    <div id='county-legend' class='legend' style='display: none;'>
        <h4>Legende quand j'ai zoom√©</h4>
        <div><span style='background-color: #723122'></span>1,000,000</div>
        <div><span style='background-color: #8B4225'></span>500,000</div>
        <div><span style='background-color: #A25626'></span>100,000</div>
        <div><span style='background-color: #B86B25'></span>50,000</div>
        <div><span style='background-color: #CA8323'></span>10,000</div>
        <div><span style='background-color: #DA9C20'></span>5,000</div>
        <div><span style='background-color: #E6B71E'></span>1,000</div>
        <div><span style='background-color: #EED322'></span>100</div>
        <div><span style='background-color: #F2F12D'></span>0</div>
    </div>

    <script>
        var map = new mapboxgl.Map({
            container: 'map',
            //style: 'mapbox://styles/mapbox/streets-v9',
            style: {
                "version": 8,
                "sources": {
                    "raster-tiles": {
                        "type": "raster",
                        "tiles": [
                            //"https://tile-a.navitia.io/osm_bright/{z}/{x}/{y}.png"
                            "http://a.tile.osm.org/{z}/{x}/{y}.png"
                        ]
                    },
                    "bus_vectoriel": {
                        "type": "vector",
                        "tiles": [
                            "http://localhost:3579/all/{z}/{x}/{y}.pbf"
                        ]
                    },
                },
                "layers": [{
                        "id": "simple-tiles",
                        "type": "raster",
                        "source": "raster-tiles",
                        "minzoom": 0,
                        "maxzoom": 22
                    }

                ],
                center: [1.846412, 48.989759],
                //center: [2.369682, 48.736836]
                minZoom: 2,
                zoom: 6,
            }
        });

        var zoomThreshold = 8;

        map.on('load', function() {

            map.addLayer({
                'id': 'country-stop-density',
                'source': 'bus_vectoriel',
                'source-layer': 'density_country',
                'maxzoom': zoomThreshold,
                'type': 'fill',
                //'layout': {},
                'paint': {
                    'fill-color': {
                        property: 'count',
                        stops: [
                            [10, '#F2F12D'],
                            [500, '#EED322'],
                            [750, '#E6B71E'],
                            [2500, '#DA9C20'],
                            [5000, '#CA8323'],
                            [7500, '#B86B25'],
                            [10000, '#A25626'],
                            [30000, '#8B4225'],
                            [50000, '#723122']
                        ]
                    },
                    "fill-opacity": 0.75,
                }
            });


        });

        var stateLegendEl = document.getElementById('state-legend');
        var countyLegendEl = document.getElementById('county-legend');
        map.on('zoom', function() {
            if (map.getZoom() > zoomThreshold) {
                stateLegendEl.style.display = 'none';
                countyLegendEl.style.display = 'block';
            } else {
                stateLegendEl.style.display = 'block';
                countyLegendEl.style.display = 'none';
            }
        });
    </script>

</body>

</html>
